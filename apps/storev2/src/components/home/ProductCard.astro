---





import { formatCurrency } from "@vit/shared/utils";
import { productColors } from "@/lib/constant";
import type { ProductForHome } from "@/lib/types";
import AddToCartButton from "../cart/add-to-cart-button.tsx";

interface Props {
    product: ProductForHome;
    badgeStyle?: "featured" | "new" | "discount";
}

const { product: p } = Astro.props;

const randomColor =
    productColors[Math.floor(Math.random() * productColors.length)];
---

<div
    class="group relative flex flex-col rounded-sm border-3 sm:border-4 border-black bg-white shadow-[4px_4px_0_0_#000] sm:shadow-[8px_8px_0_0_#000] hover:shadow-[2px_2px_0_0_#000] sm:hover:shadow-[4px_4px_0_0_#000] hover:translate-x-[2px] sm:hover:translate-x-[4px] hover:translate-y-[2px] sm:hover:translate-y-[4px] transition-all duration-200"
    aria-label={`${p.name} by ${p.brand}`}
>
    <a
        href={`/products/${p.slug}-${p.id}`}
        class="focus:outline-none focus:ring-4 focus:ring-black/40 flex flex-col flex-1"
    >
        <div
            transition:name={`product-image-${p.id}`}
            class="relative aspect-[4/5] sm:aspect-[4/3] overflow-hidden border-b-3 sm:border-b-4 border-black"
            style={`background:${randomColor}`}
        >
            <div
                class="absolute inset-0 bg-[radial-gradient(circle_at_20%_20%,rgba(0,0,0,0.07)_2px,transparent_0)] bg-[size:14px_14px]"
            >
            </div>
            {
                p.image && (
                    <img
                        src={p.image}
                        alt={p.name}
                        class="absolute inset-0 w-full h-full object-contain p-3 sm:p-4"
                        width={400}
                        height={500}
                        loading="lazy"
                    />
                )
            }
            <div
            transition:name={`product-brand-${p.id}`}
                class="absolute bottom-2 sm:bottom-3 right-2 sm:right-3 rounded-full border-2 border-black bg-white px-2 sm:px-3 py-0.5 sm:py-1 text-[9px] sm:text-[10px] font-black uppercase tracking-tight shadow-[2px_2px_0_0_#000] sm:shadow-[3px_3px_0_0_#000]"
            >
                {p.brand}
            </div>
        </div>
        <div class="flex flex-col flex-1 p-2 sm:p-3">
            <h3
                transition:name={`product-name-${p.id}`}
                class="mb-1.5 sm:mb-2 text-sm sm:text-base font-black leading-tight tracking-tight group-hover:underline line-clamp-2"
            >
                {p.name}
            </h3>

            <div class="flex items-center gap-1.5 sm:gap-2 mt-auto">
                {
                    p.discount && (
                        <div class="text-xs sm:text-lg font-bold text-black/35 line-through">
                            {formatCurrency(
                                p.price * (1 - p.discount / 100),
                            )}
                        </div>
                    )
                }
                <div
                transition:name={`product-price-${p.id}`}
                    class:list={[
                        "font-black tracking-tight",
                        p.discount
                            ? "text-xl sm:text-3xl text-destructive"
                            : "text-xl sm:text-3xl",
                    ]}
                >
                
                    {formatCurrency(p.price)}
                </div>
            </div>
        </div>
    </a>
    <div class="p-2 pt-0 sm:p-3 sm:pt-0" transition:name=`product-add-to-cart-button-${p.id}`>
        <AddToCartButton
            client:load
            cartItem={{
                productId: p.id,
                quantity: 1,
                name: p.name,
                price: p.price,
                image: p.image,
            }}
        >
            <button 
                slot="fallback"
                disabled
                class="w-full border-[3px] border-black bg-primary px-4 py-3 font-black text-sm uppercase shadow-[4px_4px_0_0_#000] opacity-50"
            >
                <div class="h-4 bg-black/10 w-32 mx-auto animate-pulse"></div>
            </button>
        </AddToCartButton>
    </div>
</div>
