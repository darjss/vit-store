---

import LogoutButton from "@/components/auth/logout-button";
import { createServerClient } from "@/lib/trpc";

const cookieHeader = Astro.request.headers.get("cookie") || "";
const serverApi = createServerClient(cookieHeader, Astro.locals.runtime.env.server);

let user = null;
try {
	user = await serverApi.auth.check.query();
} catch (error) {
	console.log(error)
}
---

{user ? (
    <div class="flex items-center justify-between gap-2">
        <div class="flex items-center gap-3 min-w-0 flex-1">
            <div class="w-10 h-10 bg-primary text-primary-foreground border-3 border-border flex items-center justify-center font-black text-lg flex-shrink-0">
                {user.phone || "U"}
            </div>
            <div class="min-w-0">
                <p class="font-bold text-sm truncate">{user.phone}</p>
                <p class="text-xs opacity-70">Тавтай морил!</p>
            </div>
        </div>
        <LogoutButton client:visible class="!p-1.5 !border-2 !shadow-none hover:!bg-destructive hover:!text-destructive-foreground flex-shrink-0 [&>div]:!p-0 [&_span]:hidden [&_svg]:!h-5 [&_svg]:!w-5" />
    </div>
) : (
    <div class="flex gap-3">
        <a 
            href="/login" 
            class="flex-1 flex items-center justify-center gap-2 py-3 bg-primary text-primary-foreground border-3 border-border font-black text-sm uppercase tracking-wide shadow-hard-sm hover:shadow-none hover:translate-x-[2px] hover:translate-y-[2px] transition-all"
        >
            Нэвтрэх
        </a>
        <a 
            href="/register" 
            class="flex-1 flex items-center justify-center gap-2 py-3 bg-background text-foreground border-3 border-border font-black text-sm uppercase tracking-wide shadow-hard-sm hover:shadow-none hover:translate-x-[2px] hover:translate-y-[2px] transition-all"
        >
            Бүртгүүлэх
        </a>
    </div>
)}
