---

import ProductQuantitySelector from "@/components/product/product-add-to-cart";
import { formatCurrency } from "@/lib/utils";
import IconBox from "~icons/ri/box-3-line";
import IconMuscle from "~icons/ri/boxing-line";
import IconCheck from "~icons/ri/checkbox-circle-fill";
import IconFire from "~icons/ri/fire-fill";
import IconFlask from "~icons/ri/flask-line";
import IconPriceTag from "~icons/ri/price-tag-3-fill";
import IconRefund from "~icons/ri/refund-2-line";
import IconShield from "~icons/ri/shield-check-line";
import IconTruck from "~icons/ri/truck-line";

interface Props {
	product: {
		id: number;
		name: string;
		price: number;
		discount?: number | null;
		brand: { name: string };
		category: { name: string };
		status: string;
		amount?: string | null;
		potency?: string | null;
	};
	primaryImage: string;
}

const { product, primaryImage } = Astro.props;

const discountedPrice = product.discount
	? product.price * (1 - product.discount / 100)
	: product.price;
const hasDiscount = product.discount && product.discount > 0;
const savings = hasDiscount ? product.price - discountedPrice : 0;
---

<div class="space-y-6 sm:space-y-8">
	<div
		transition:name={`product-brand-${product.id}`}
		class="inline-flex items-center gap-2 border-2 border-border bg-background px-3 py-1.5 sm:px-4 sm:py-2 font-black text-xs sm:text-sm uppercase shadow-hard-sm"
	>
		<IconPriceTag class="w-4 h-4 text-amber-500" />
		<span>{product.brand.name}</span>
	</div>

	<h1
		transition:name={`product-name-${product.id}`}
		class="text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-black leading-tight tracking-tight uppercase"
	>
		{product.name}
	</h1>

	<div class="flex flex-wrap gap-3">
		<div
			class="flex items-center gap-2 border-2 border-border bg-muted px-3 py-1.5 text-xs sm:text-sm font-bold uppercase tracking-wide"
		>
			<IconBox class="w-4 h-4 text-blue-500" /> {product.category.name}
		</div>
		{
			product.amount && (
				<div class="flex items-center gap-2 border-2 border-border bg-muted px-3 py-1.5 text-xs sm:text-sm font-bold uppercase tracking-wide">
					<IconFlask class="w-4 h-4 text-purple-500" /> {product.amount}
				</div>
			)
		}
		{
			product.potency && (
				<div class="flex items-center gap-2 border-2 border-border bg-muted px-3 py-1.5 text-xs sm:text-sm font-bold uppercase tracking-wide">
					<IconMuscle class="w-4 h-4 text-green-500" /> {product.potency}
				</div>
			)
		}
	</div>

	<div
		class="border-2 border-border bg-card p-6 sm:p-8 shadow-hard"
	>
		{hasDiscount ? (
			<div class="space-y-4">
				{/* Discount Badge */}
				<div class="inline-flex items-center gap-2 border-2 border-border bg-destructive px-4 py-1.5 font-black text-sm sm:text-base text-destructive-foreground shadow-hard-sm uppercase tracking-wider">
					<IconFire class="w-4 h-4 text-yellow-300" /> {product.discount}% ХЯМДРАЛ
				</div>
				
				{/* Price Container */}
				<div class="space-y-2">
					<div class="flex items-baseline gap-4 flex-wrap">
						{/* Original Price */}
						<div class="text-xl sm:text-2xl font-bold text-muted-foreground line-through decoration-2 decoration-destructive" transition:name={`product-price-${product.id}`}>
							{formatCurrency(product.price)}
						</div>
					</div>
					
					{/* Sale Price */}
					<div class="text-5xl sm:text-6xl font-black text-foreground tracking-tight">
						{formatCurrency(discountedPrice)}
					</div>
					
					{/* Savings Display */}
					<div class="text-base sm:text-lg font-bold text-primary">
						{formatCurrency(savings)} хэмнэлт
					</div>
				</div>
			</div>
		) : (
			<div class="space-y-3">
				<div class="text-sm font-bold text-muted-foreground uppercase tracking-wider">
					Үнэ
				</div>
				<div class="text-5xl sm:text-6xl font-black text-foreground tracking-tight" transition:name={`product-price-${product.id}`}>
					{formatCurrency(product.price)}
				</div>
			</div>
		)}
	</div>

	<div transition:name={`product-add-to-cart-button-${product.id}`}>
		<ProductQuantitySelector
			client:load
			cartItem={{
				productId: product.id,
				quantity: 1,
				name: product.name,
				price: product.price,
				image: primaryImage,
			}}
		>
			<div slot="fallback" class="flex gap-4">
				<div class="h-16 flex-1 border-2 border-border bg-muted/20 shadow-hard animate-pulse"></div>
				<div class="h-16 w-16 border-2 border-border bg-muted/20 shadow-hard animate-pulse"></div>
				<div class="h-16 w-16 border-2 border-border bg-muted/20 shadow-hard animate-pulse"></div>
			</div>
		</ProductQuantitySelector>
	</div>

	<div class="border-2 border-border bg-background p-4 sm:p-6 shadow-hard">
		<div class="grid grid-cols-2 gap-4">
			<div class="flex items-center gap-3 text-xs sm:text-sm font-bold text-foreground/80 uppercase tracking-wide">
				<IconCheck class="w-5 h-5 text-green-500" />
				<span>Баталгаатай</span>
			</div>
			<div class="flex items-center gap-3 text-xs sm:text-sm font-bold text-foreground/80 uppercase tracking-wide">
				<IconTruck class="w-5 h-5 text-blue-500" />
				<span>Хурдан хүргэлт</span>
			</div>
			<div class="flex items-center gap-3 text-xs sm:text-sm font-bold text-foreground/80 uppercase tracking-wide">
				<IconShield class="w-5 h-5 text-purple-500" />
				<span>Найдвартай</span>
			</div>
			<div class="flex items-center gap-3 text-xs sm:text-sm font-bold text-foreground/80 uppercase tracking-wide">
				<IconRefund class="w-5 h-5 text-orange-500" />
				<span>Буцаалт</span>
			</div>
		</div>
	</div>
</div>
