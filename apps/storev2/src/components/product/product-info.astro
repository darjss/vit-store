---
import { formatCurrency } from "@vit/shared/utils";
import ProductAddToCart from "./product-add-to-cart";

interface Props {
	product: {
		id: number;
		name: string;
		price: number;
		discount?: number | null;
		brand: { name: string };
		category: { name: string };
		status: string;
		amount?: string | null;
		potency?: string | null;
	};
	primaryImage: string;
}

const { product, primaryImage } = Astro.props;

const discountedPrice = product.discount
	? product.price * (1 - product.discount / 100)
	: product.price;
const hasDiscount = product.discount && product.discount > 0;
const savings = hasDiscount ? product.price - discountedPrice : 0;
---

<div class="space-y-4 sm:space-y-6">
	{/* Brand Badge */}
	<div
		class="inline-flex items-center gap-2 rounded-sm border-3 border-black bg-white px-3 py-1.5 sm:px-4 sm:py-2 font-black text-xs sm:text-sm uppercase shadow-[3px_3px_0_0_#000]"
	>
		<span>üè∑Ô∏è</span>
		<span>{product.brand.name}</span>
	</div>

	{/* Product Title */}
	<h1
		class="text-2xl sm:text-3xl md:text-4xl lg:text-5xl font-black leading-tight tracking-tight"
	>
		{product.name}
	</h1>

	{/* Category & Specs Pills */}
	<div class="flex flex-wrap gap-2">
		<div
			class="rounded-sm border-2 border-black bg-muted px-2.5 py-1 text-xs sm:text-sm font-bold"
		>
			üì¶ {product.category.name}
		</div>
		{
			product.amount && (
				<div class="rounded-sm border-2 border-black bg-muted px-2.5 py-1 text-xs sm:text-sm font-bold">
					‚öñÔ∏è {product.amount}
				</div>
			)
		}
		{
			product.potency && (
				<div class="rounded-sm border-2 border-black bg-muted px-2.5 py-1 text-xs sm:text-sm font-bold">
					üí™ {product.potency}
				</div>
			)
		}
	</div>

	{/* Enhanced Price Section */}
	<div
		class="rounded-sm border-4 border-black bg-gradient-to-br from-primary/30 to-primary/50 p-4 sm:p-6 shadow-[6px_6px_0_0_#000]"
	>
		{hasDiscount ? (
			<div class="space-y-3">
				{/* Discount Badge */}
				<div class="inline-flex items-center gap-2 rounded-sm border-3 border-black bg-red-500 px-3 py-1 font-black text-sm sm:text-base text-white shadow-[3px_3px_0_0_#000]">
					üî• {product.discount}% –•–Ø–ú–î–†–ê–õ
				</div>
				
				{/* Price Container */}
				<div class="space-y-1">
					<div class="flex items-baseline gap-3 flex-wrap">
						{/* Original Price */}
						<div class="text-lg sm:text-xl font-bold text-black/50 line-through">
							{formatCurrency(product.price)}
						</div>
					</div>
					
					{/* Sale Price */}
					<div class="text-4xl sm:text-5xl font-black text-black">
						{formatCurrency(discountedPrice)}
					</div>
					
					{/* Savings Display */}
					<div class="text-sm sm:text-base font-bold text-green-700">
						{formatCurrency(savings)} —Ö—ç–º–Ω—ç–ª—Ç
					</div>
				</div>
			</div>
		) : (
			<div class="space-y-2">
				<div class="text-sm font-bold text-black/60 uppercase tracking-wide">
					“Æ–Ω—ç
				</div>
				<div class="text-4xl sm:text-5xl font-black text-black">
					{formatCurrency(product.price)}
				</div>
			</div>
		)}
	</div>

	{/* Status Badge */}
	{
		product.status === "active" && (
			<div class="flex items-center gap-2 rounded-sm border-2 border-black bg-green-100 px-3 py-2 shadow-[3px_3px_0_0_#000]">
				<span class="inline-block size-2.5 sm:size-3 rounded-full border-2 border-black bg-green-500" />
				<span class="text-xs sm:text-sm font-bold text-green-800">–ù”©”©—Ü—Ç—ç–π –±–∞ —Ö“Ø—Ä–≥—ç–ª—Ç—ç–Ω–¥ –±—ç–ª—ç–Ω</span>
			</div>
		)
	}

	{/* Interactive Add to Cart - SolidJS */}
	<ProductAddToCart
		client:load
		cartItem={{
			productId: product.id,
			quantity: 1,
			name: product.name,
			price: product.price,
			image: primaryImage,
		}}
	/>

	{/* Trust Signals */}
	<div class="rounded-sm border-2 border-black bg-white/80 p-3 sm:p-4 shadow-[3px_3px_0_0_#000]">
		<div class="grid grid-cols-2 gap-3">
			<div class="flex items-center gap-2 text-xs sm:text-sm font-bold text-black/80">
				<span class="text-base">‚úì</span>
				<span>–ë–∞—Ç–∞–ª–≥–∞–∞—Ç–∞–π</span>
			</div>
			<div class="flex items-center gap-2 text-xs sm:text-sm font-bold text-black/80">
				<span class="text-base">üöö</span>
				<span>–•—É—Ä–¥–∞–Ω —Ö“Ø—Ä–≥—ç–ª—Ç</span>
			</div>
			<div class="flex items-center gap-2 text-xs sm:text-sm font-bold text-black/80">
				<span class="text-base">üîí</span>
				<span>–ù–∞–π–¥–≤–∞—Ä—Ç–∞–π</span>
			</div>
			<div class="flex items-center gap-2 text-xs sm:text-sm font-bold text-black/80">
				<span class="text-base">‚Ü©Ô∏è</span>
				<span>–ë—É—Ü–∞–∞–ª—Ç</span>
			</div>
		</div>
	</div>
</div>
