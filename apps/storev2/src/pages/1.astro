---
import AddToCartButton from "@/components/cart/add-to-cart-button";
import Layout from "@/layouts/Layout.astro";
import { productColors } from "@/lib/constant";
import { api } from "@/lib/trpc";
import type { ProductForHome } from "@/lib/types";
import { formatCurrency } from "@/lib/utils";

export const prerender = true;

const products = await api.product.getProductsForHome.query();
const { featuredProducts, newProducts, discountedProducts } = products;
const brands = await api.brand.getAllBrands.query();
---

<Layout>
  <!-- DESIGN 1: "WARM EDITORIAL" -->
  <!-- Light, magazine-style, product-image-forward, clear value props -->
  <!-- Audience: Women 25-40+, moms, health-conscious shoppers who want trust + ease -->

  <!-- Hero -->
  <section class="relative overflow-hidden bg-background border-b-2 border-border">
    <div class="absolute inset-0 bg-grid-pattern opacity-[0.04] pointer-events-none"></div>

    <div class="max-w-screen-2xl mx-auto px-4 sm:px-6 lg:px-8 pt-10 pb-16 md:pt-16 md:pb-24">
      <!-- Eyebrow -->
      <div class="text-center mb-10 md:mb-14">
        <div class="inline-flex items-center gap-3 mb-6">
          <div class="h-px w-10 bg-border"></div>
          <span class="text-[10px] font-bold uppercase tracking-[0.25em] text-muted-foreground">АНУ-аас шууд импорт</span>
          <div class="h-px w-10 bg-border"></div>
        </div>
        <h1 class="text-4xl md:text-6xl lg:text-7xl font-black uppercase leading-[0.9] tracking-tighter mb-5">
          Гэр бүлийн эрүүл мэнд,<br />
          <span class="text-primary">нэг дэлгүүрээс.</span>
        </h1>
        <p class="text-base md:text-lg font-medium text-muted-foreground max-w-xl mx-auto leading-relaxed mb-8">
          FDA баталгаат, лабораторид шалгагдсан витамин, нэмэлт тэжээл. Хүргэлттэй.
        </p>
        <a href="/products" class="inline-flex items-center gap-2 px-8 py-3.5 bg-foreground text-background font-bold text-sm uppercase tracking-wider border-2 border-foreground hover:bg-primary hover:text-foreground hover:border-border transition-colors">
          Бүтээгдэхүүн үзэх
        </a>
      </div>

      <!-- Hero product trio -->
      <div class="grid grid-cols-3 gap-3 md:gap-5 max-w-4xl mx-auto">
        {featuredProducts.slice(0, 3).map((p: ProductForHome, i: number) => (
          <a href={`/products/${p.slug}-${p.id}`} class={`group block border-2 border-border overflow-hidden bg-card hover:shadow-hard transition-all hover:-translate-y-1 ${i === 1 ? 'md:-translate-y-4 md:hover:-translate-y-5' : ''}`}>
            <div class="relative aspect-[3/4] overflow-hidden border-b-2 border-border" style={`background: ${productColors[p.id % productColors.length]}`}>
              {p.image && (
                <img src={p.image} alt={p.name} class="absolute inset-0 w-full h-full object-contain p-4 md:p-8 group-hover:scale-105 transition-transform duration-500" width="400" height="500" loading="lazy" />
              )}
            </div>
            <div class="p-2.5 md:p-4">
              <div class="text-[8px] md:text-[9px] font-bold uppercase tracking-widest text-muted-foreground">{p.brand}</div>
              <h3 class="text-[11px] md:text-sm font-bold leading-tight line-clamp-1 mt-0.5">{p.name}</h3>
              <div class="font-black text-sm md:text-base mt-1">{formatCurrency(p.price)}</div>
            </div>
          </a>
        ))}
      </div>
    </div>
  </section>

  <!-- Trust strip -->
  <section class="border-b-2 border-border bg-muted/30">
    <div class="max-w-screen-2xl mx-auto grid grid-cols-2 md:grid-cols-4">
      {[
        { val: "100%", label: "Жинхэнэ бүтээгдэхүүн" },
        { val: "FDA", label: "Стандарт баталгаа" },
        { val: "24-48ц", label: "Хүргэлт УБ хотод" },
        { val: "30K+", label: "Үнэгүй хүргэлт" },
      ].map((s, i) => (
        <div class={`py-4 md:py-5 px-4 text-center ${i < 3 ? 'border-r-2 border-border' : ''} ${i < 2 ? 'border-b-2 md:border-b-0 border-border' : ''}`}>
          <div class="text-lg md:text-xl font-black">{s.val}</div>
          <div class="text-[9px] md:text-[10px] font-bold uppercase tracking-wider text-muted-foreground mt-0.5">{s.label}</div>
        </div>
      ))}
    </div>
  </section>

  <!-- Featured -->
  <section class="border-b-2 border-border">
    <div class="max-w-screen-2xl mx-auto px-4 sm:px-6 lg:px-8 py-14 md:py-20">
      <div class="flex items-end justify-between mb-8 md:mb-10">
        <div>
          <h2 class="text-3xl md:text-4xl font-black uppercase tracking-tight">Онцлох бүтээгдэхүүн</h2>
          <p class="text-sm text-muted-foreground font-medium mt-1">Хамгийн их захиалагддаг</p>
        </div>
        <a href="/products?filter=featured" class="hidden sm:inline-flex px-4 py-2 border-2 border-border font-bold text-xs uppercase tracking-wider hover:bg-foreground hover:text-background transition-colors">
          Бүгдийг үзэх
        </a>
      </div>

      <div class="grid grid-cols-2 lg:grid-cols-4 gap-3 md:gap-5">
        {featuredProducts.map((p: ProductForHome) => (
          <div class="group border-2 border-border bg-card hover:shadow-hard transition-all hover:-translate-y-0.5">
            <a href={`/products/${p.slug}-${p.id}`} class="block">
              <div class="relative aspect-square overflow-hidden border-b-2 border-border" style={`background: ${productColors[p.id % productColors.length]}`}>
                {p.image && (
                  <img src={p.image} alt={p.name} class="absolute inset-0 w-full h-full object-contain p-5 group-hover:scale-105 transition-transform duration-300" width="400" height="400" loading="lazy" />
                )}
              </div>
            </a>
            <div class="p-2.5 md:p-3.5">
              <div class="text-[8px] md:text-[9px] font-bold uppercase tracking-widest text-muted-foreground">{p.brand}</div>
              <a href={`/products/${p.slug}-${p.id}`}>
                <h3 class="text-[11px] md:text-sm font-bold line-clamp-2 mt-0.5 leading-tight group-hover:underline">{p.name}</h3>
              </a>
              <div class="flex items-center justify-between mt-2.5 pt-2.5 border-t-2 border-border">
                <span class="font-black text-sm md:text-base">{formatCurrency(p.price)}</span>
                <AddToCartButton client:load compact cartItem={{ productId: p.id, quantity: 1, name: p.name, price: p.price, image: p.image }} />
              </div>
            </div>
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- Categories: Horizontal tags -->
  <section class="border-b-2 border-border bg-muted/20">
    <div class="max-w-screen-2xl mx-auto px-4 sm:px-6 lg:px-8 py-14 md:py-16">
      <h2 class="text-2xl md:text-3xl font-black uppercase tracking-tight mb-6 text-center">Ангилалаар хайх</h2>
      <div class="flex flex-wrap justify-center gap-2 md:gap-3">
        {["Дархлаа", "Гоо сайхан", "Энерги", "Яс үе мөч", "Зүрх судас", "Ходоод гэдэс", "Нойр", "Тархи мэдрэл"].map((cat) => (
          <a href={`/products?category=${encodeURIComponent(cat)}`} class="px-4 md:px-5 py-2 md:py-2.5 border-2 border-border bg-card font-bold text-xs md:text-sm uppercase tracking-wider hover:bg-foreground hover:text-background transition-colors">
            {cat}
          </a>
        ))}
      </div>
    </div>
  </section>

  <!-- New arrivals -->
  <section class="border-b-2 border-border">
    <div class="max-w-screen-2xl mx-auto px-4 sm:px-6 lg:px-8 py-14 md:py-20">
      <div class="flex items-end justify-between mb-8 md:mb-10">
        <div>
          <h2 class="text-3xl md:text-4xl font-black uppercase tracking-tight">Шинэ ирсэн</h2>
          <p class="text-sm text-muted-foreground font-medium mt-1">Сүүлд нэмэгдсэн бүтээгдэхүүнүүд</p>
        </div>
        <a href="/products?filter=recent" class="hidden sm:inline-flex px-4 py-2 border-2 border-border font-bold text-xs uppercase tracking-wider hover:bg-foreground hover:text-background transition-colors">
          Бүгдийг үзэх
        </a>
      </div>

      <div class="flex overflow-x-auto gap-3 md:gap-5 pb-4 -mx-4 px-4 snap-x snap-mandatory scrollbar-hide lg:grid lg:grid-cols-4 lg:overflow-visible lg:mx-0 lg:px-0 lg:pb-0">
        {newProducts.map((p: ProductForHome) => (
          <div class="flex-none w-[220px] lg:w-auto snap-start group border-2 border-border bg-card hover:shadow-hard transition-all hover:-translate-y-0.5">
            <a href={`/products/${p.slug}-${p.id}`} class="block">
              <div class="relative aspect-square overflow-hidden border-b-2 border-border" style={`background: ${productColors[p.id % productColors.length]}`}>
                {p.image && (
                  <img src={p.image} alt={p.name} class="absolute inset-0 w-full h-full object-contain p-5 group-hover:scale-105 transition-transform duration-300" width="400" height="400" loading="lazy" />
                )}
              </div>
            </a>
            <div class="p-2.5 md:p-3.5">
              <div class="text-[8px] md:text-[9px] font-bold uppercase tracking-widest text-muted-foreground">{p.brand}</div>
              <a href={`/products/${p.slug}-${p.id}`}>
                <h3 class="text-[11px] md:text-sm font-bold line-clamp-2 mt-0.5 leading-tight group-hover:underline">{p.name}</h3>
              </a>
              <div class="flex items-center justify-between mt-2.5 pt-2.5 border-t-2 border-border">
                <span class="font-black text-sm md:text-base">{formatCurrency(p.price)}</span>
                <AddToCartButton client:load compact cartItem={{ productId: p.id, quantity: 1, name: p.name, price: p.price, image: p.image }} />
              </div>
            </div>
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- Discounted -->
  <section class="border-b-2 border-border bg-primary/5">
    <div class="max-w-screen-2xl mx-auto px-4 sm:px-6 lg:px-8 py-14 md:py-20">
      <div class="flex items-end justify-between mb-8 md:mb-10">
        <div>
          <h2 class="text-3xl md:text-4xl font-black uppercase tracking-tight">Хямдралтай</h2>
          <p class="text-sm text-muted-foreground font-medium mt-1">Тусгай үнийн санал</p>
        </div>
        <a href="/products?filter=discount" class="hidden sm:inline-flex px-4 py-2 border-2 border-border font-bold text-xs uppercase tracking-wider hover:bg-foreground hover:text-background transition-colors">
          Бүгдийг үзэх
        </a>
      </div>

      <div class="grid grid-cols-2 lg:grid-cols-4 gap-3 md:gap-5">
        {discountedProducts.map((p: ProductForHome) => (
          <div class="group border-2 border-border bg-card hover:shadow-hard transition-all hover:-translate-y-0.5">
            <a href={`/products/${p.slug}-${p.id}`} class="block">
              <div class="relative aspect-[4/3] overflow-hidden border-b-2 border-border" style={`background: ${productColors[p.id % productColors.length]}`}>
                {p.discount && (
                  <div class="absolute top-2 left-2 z-10 px-2 py-0.5 bg-foreground text-background text-[10px] font-black">-{p.discount}%</div>
                )}
                {p.image && (
                  <img src={p.image} alt={p.name} class="absolute inset-0 w-full h-full object-contain p-4 group-hover:scale-105 transition-transform duration-300" width="400" height="300" loading="lazy" />
                )}
              </div>
            </a>
            <div class="p-2.5 md:p-3.5">
              <div class="text-[8px] md:text-[9px] font-bold uppercase tracking-widest text-muted-foreground">{p.brand}</div>
              <a href={`/products/${p.slug}-${p.id}`}>
                <h3 class="text-[11px] md:text-sm font-bold line-clamp-2 mt-0.5 leading-tight group-hover:underline">{p.name}</h3>
              </a>
              <div class="flex items-center justify-between mt-2.5 pt-2.5 border-t-2 border-border">
                <span class="font-black text-sm md:text-base">{formatCurrency(p.price)}</span>
                <AddToCartButton client:load compact cartItem={{ productId: p.id, quantity: 1, name: p.name, price: p.price, image: p.image }} />
              </div>
            </div>
          </div>
        ))}
      </div>
      <p class="mt-5 text-[10px] font-semibold text-muted-foreground text-center">Эмнэлгийн зөвлөгөө биш. Мэргэжлийн эмчид хандана уу.</p>
    </div>
  </section>

  <!-- Brand ticker -->
  <section class="border-b-2 border-border overflow-hidden">
    <div class="py-4 flex items-center gap-12 whitespace-nowrap" style="animation: brand-scroll-1 35s linear infinite;">
      {[...Array(4)].map(() => brands.map((brand: {name: string}) => (
        <span class="text-lg md:text-xl font-black uppercase tracking-wider text-muted-foreground/30 flex items-center gap-12">
          {brand.name}
          <span class="w-1.5 h-1.5 bg-primary/40 rotate-45 block"></span>
        </span>
      )))}
    </div>
  </section>

  <!-- CTA -->
  <section class="py-14 md:py-20">
    <div class="max-w-screen-2xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="border-4 border-border bg-primary p-8 md:p-14 shadow-hard-lg relative overflow-hidden">
        <div class="absolute inset-0 bg-grid-pattern opacity-10 pointer-events-none"></div>
        <div class="relative z-10 max-w-xl mx-auto text-center">
          <h2 class="text-3xl md:text-5xl font-black uppercase tracking-tight mb-4">Гэр бүлдээ зориулаарай</h2>
          <p class="text-sm md:text-base font-medium mb-8">АНУ-ын шилдэг брэндүүдийн баталгаат витамин, нэмэлт тэжээл — хүргэлттэй.</p>
          <a href="/products" class="inline-flex px-10 py-4 bg-foreground text-background font-black text-sm uppercase tracking-wider border-2 border-foreground hover:bg-background hover:text-foreground transition-colors">
            Дэлгүүр хэсэх
          </a>
        </div>
      </div>
    </div>
  </section>
</Layout>

<style>
  @keyframes brand-scroll-1 {
    0% { transform: translateX(0); }
    100% { transform: translateX(-50%); }
  }
</style>
