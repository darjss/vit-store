---
import AddToCartButton from "@/components/cart/add-to-cart-button";
import Layout from "@/layouts/Layout.astro";
import { productColors } from "@/lib/constant";
import { api } from "@/lib/trpc";
import type { ProductForHome } from "@/lib/types";
import { formatCurrency } from "@/lib/utils";

export const prerender = true;

const products = await api.product.getProductsForHome.query();
const { featuredProducts, newProducts, discountedProducts } = products;
const brands = await api.brand.getAllBrands.query();

const healthConcerns = [
  { name: "–î–∞—Ä—Ö–ª–∞–∞", icon: "üõ°Ô∏è", bg: "#E3F2FD" },
  { name: "–ì–æ–æ —Å–∞–π—Ö–∞–Ω", icon: "‚ú®", bg: "#FCE4EC" },
  { name: "–≠–Ω–µ—Ä–≥–∏", icon: "‚ö°", bg: "#FFF8E1" },
  { name: "–Ø—Å “Ø–µ –º”©—á", icon: "ü¶¥", bg: "#E8F5E9" },
  { name: "–ó“Ø—Ä—Ö —Å—É–¥–∞—Å", icon: "‚ù§Ô∏è", bg: "#FFEBEE" },
  { name: "–•–æ–¥–æ–æ–¥ –≥—ç–¥—ç—Å", icon: "üåø", bg: "#F1F8E9" },
  { name: "–ù–æ–π—Ä", icon: "üåô", bg: "#EDE7F6" },
  { name: "–¢–∞—Ä—Ö–∏ –º—ç–¥—Ä—ç–ª", icon: "üß†", bg: "#E0F7FA" },
];
---

<Layout>
  <!-- DESIGN 5: "BOUTIQUE" -->
  <!-- Curated shop feel. Sections organized by health concern. -->
  <!-- Warm accent colors, feels like a carefully curated wellness boutique. -->

  <!-- Hero: Boutique welcome -->
  <section class="relative overflow-hidden border-b-2 border-border">
    <div class="absolute inset-0 bg-grid-pattern opacity-[0.03] pointer-events-none"></div>
    <div class="max-w-screen-2xl mx-auto px-4 sm:px-6 lg:px-8 py-12 md:py-20">
      <div class="max-w-3xl mx-auto text-center">
        <div class="inline-flex items-center gap-3 mb-6">
          <div class="h-px w-10 bg-border"></div>
          <span class="text-[10px] font-bold uppercase tracking-[0.3em] text-muted-foreground">Amerik Vitamin</span>
          <div class="h-px w-10 bg-border"></div>
        </div>
        <h1 class="text-4xl md:text-5xl lg:text-6xl font-black uppercase leading-[0.9] tracking-tighter mb-5">
          –¢–∞–Ω–¥ –∑–æ—Ä–∏—É–ª—Å–∞–Ω<br />
          <span class="text-primary">–≤–∏—Ç–∞–º–∏–Ω —Ü—É–≥–ª—É—É–ª–≥–∞</span>
        </h1>
        <p class="text-sm md:text-base font-medium text-muted-foreground max-w-lg mx-auto leading-relaxed mb-8">
          –ê–ù–£-—ã–Ω —à–∏–ª–¥—ç–≥ –±—Ä—ç–Ω–¥“Ø“Ø–¥–∏–π–Ω –±–∞—Ç–∞–ª–≥–∞–∞—Ç –≤–∏—Ç–∞–º–∏–Ω, –Ω—ç–º—ç–ª—Ç —Ç—ç–∂—ç—ç–ª. –≠—Ä“Ø“Ø–ª –º—ç–Ω–¥–∏–π–Ω –∑–æ—Ä–∏–ª–≥–æ–æ—Ä–æ–æ —Å–æ–Ω–≥–æ–æ—Ä–æ–π.
        </p>
        <a href="/products" class="inline-flex items-center gap-2 px-8 py-3.5 bg-foreground text-background font-bold text-sm uppercase tracking-wider border-2 border-foreground hover:bg-primary hover:text-foreground hover:border-border transition-colors">
          –ë“Ø–≥–¥–∏–π–≥ “Ø–∑—ç—Ö
        </a>
      </div>
    </div>
  </section>

  <!-- Shop by Health Concern ‚Äî The "boutique" differentiator -->
  <section class="border-b-2 border-border">
    <div class="max-w-screen-2xl mx-auto px-4 sm:px-6 lg:px-8 py-12 md:py-16">
      <div class="text-center mb-8 md:mb-10">
        <span class="text-[10px] font-bold uppercase tracking-[0.25em] text-muted-foreground">–ó–æ—Ä–∏–ª–≥–æ–æ—Ä–æ–æ —Å–æ–Ω–≥–æ–æ—Ä–æ–π</span>
        <h2 class="text-2xl md:text-3xl font-black uppercase tracking-tight mt-1">–≠—Ä“Ø“Ø–ª –º—ç–Ω–¥–∏–π–Ω –∞–Ω–≥–∏–ª–∞–ª</h2>
      </div>

      <div class="grid grid-cols-2 sm:grid-cols-4 gap-2 md:gap-3">
        {healthConcerns.map((concern) => (
          <a href={`/products?category=${encodeURIComponent(concern.name)}`} class="group border-2 border-border bg-card hover:shadow-hard hover:-translate-y-1 transition-all overflow-hidden">
            <div class="p-4 md:p-5" style={`background: ${concern.bg}`}>
              <div class="text-2xl md:text-3xl mb-2">{concern.icon}</div>
              <h3 class="text-sm md:text-base font-black uppercase tracking-wider">{concern.name}</h3>
            </div>
          </a>
        ))}
      </div>
    </div>
  </section>

  <!-- Trust strip -->
  <section class="border-b-2 border-border bg-muted/30">
    <div class="max-w-screen-2xl mx-auto grid grid-cols-2 md:grid-cols-4 divide-x-2 divide-border">
      {[
        { val: "100%", label: "–ñ–∏–Ω—Ö—ç–Ω—ç –±“Ø—Ç—ç—ç–≥–¥—ç—Ö“Ø“Ø–Ω" },
        { val: "FDA", label: "–°—Ç–∞–Ω–¥–∞—Ä—Ç –±–∞—Ç–∞–ª–≥–∞–∞" },
        { val: "24-48—Ü", label: "–•“Ø—Ä–≥—ç–ª—Ç –£–ë —Ö–æ—Ç–æ–¥" },
        { val: "200+", label: "–ë“Ø—Ç—ç—ç–≥–¥—ç—Ö“Ø“Ø–Ω" },
      ].map((s, i) => (
        <div class={`py-4 md:py-5 px-4 text-center ${i < 2 ? 'border-b-2 md:border-b-0 border-border' : ''}`}>
          <div class="text-lg md:text-xl font-black">{s.val}</div>
          <div class="text-[9px] md:text-[10px] font-bold uppercase tracking-wider text-muted-foreground mt-0.5">{s.label}</div>
        </div>
      ))}
    </div>
  </section>

  <!-- Curated Pick: Large hero card + compact grid -->
  <section class="border-b-2 border-border">
    <div class="max-w-screen-2xl mx-auto px-4 sm:px-6 lg:px-8 py-14 md:py-20">
      <div class="flex items-end justify-between mb-8 md:mb-10">
        <div>
          <span class="text-[10px] font-bold uppercase tracking-[0.25em] text-muted-foreground">–ë–∏–¥–Ω–∏–π —Å–æ–Ω–≥–æ–ª—Ç</span>
          <h2 class="text-3xl md:text-4xl font-black uppercase tracking-tight mt-1">–û–Ω—Ü–ª–æ—Ö –±“Ø—Ç—ç—ç–≥–¥—ç—Ö“Ø“Ø–Ω</h2>
        </div>
        <a href="/products?filter=featured" class="hidden sm:inline-flex px-4 py-2 border-2 border-border font-bold text-xs uppercase tracking-wider hover:bg-foreground hover:text-background transition-colors">
          –ë“Ø–≥–¥–∏–π–≥ “Ø–∑—ç—Ö
        </a>
      </div>

      <!-- Row 1: Large hero card -->
      <div class="grid lg:grid-cols-2 gap-3 md:gap-4 mb-3 md:mb-4">
        {featuredProducts.slice(0, 2).map((p: ProductForHome) => (
          <div class="group border-2 border-border bg-card hover:shadow-hard-lg transition-all hover:-translate-y-1">
            <a href={`/products/${p.slug}-${p.id}`} class="block">
              <div class="relative aspect-[16/9] overflow-hidden border-b-2 border-border" style={`background: ${productColors[p.id % productColors.length]}`}>
                {p.image && (
                  <img src={p.image} alt={p.name} class="absolute inset-0 w-full h-full object-contain p-8 md:p-12 group-hover:scale-105 transition-transform duration-500" width="600" height="400" loading="lazy" />
                )}
              </div>
            </a>
            <div class="p-4 md:p-5">
              <div class="text-[9px] md:text-[10px] font-bold uppercase tracking-widest text-muted-foreground">{p.brand}</div>
              <a href={`/products/${p.slug}-${p.id}`}>
                <h3 class="text-base md:text-lg font-black leading-tight mt-1 group-hover:underline">{p.name}</h3>
              </a>
              <div class="flex items-center justify-between mt-3 pt-3 border-t-2 border-border">
                <span class="font-black text-lg md:text-xl">{formatCurrency(p.price)}</span>
                <AddToCartButton client:load compact cartItem={{ productId: p.id, quantity: 1, name: p.name, price: p.price, image: p.image }} />
              </div>
            </div>
          </div>
        ))}
      </div>

      <!-- Row 2: Compact grid -->
      <div class="grid grid-cols-2 lg:grid-cols-4 gap-2 md:gap-3">
        {featuredProducts.slice(2).map((p: ProductForHome) => (
          <div class="group border-2 border-border bg-card hover:shadow-hard transition-all hover:-translate-y-0.5">
            <a href={`/products/${p.slug}-${p.id}`} class="block">
              <div class="relative aspect-square overflow-hidden border-b-2 border-border" style={`background: ${productColors[p.id % productColors.length]}`}>
                {p.image && (
                  <img src={p.image} alt={p.name} class="absolute inset-0 w-full h-full object-contain p-4 group-hover:scale-105 transition-transform duration-300" width="400" height="400" loading="lazy" />
                )}
              </div>
            </a>
            <div class="p-2 md:p-3">
              <div class="text-[8px] md:text-[9px] font-bold uppercase tracking-widest text-muted-foreground">{p.brand}</div>
              <a href={`/products/${p.slug}-${p.id}`}>
                <h3 class="text-[10px] md:text-xs font-bold line-clamp-1 mt-0.5 group-hover:underline">{p.name}</h3>
              </a>
              <div class="flex items-center justify-between mt-2 pt-2 border-t-2 border-border">
                <span class="font-black text-sm">{formatCurrency(p.price)}</span>
                <AddToCartButton client:load compact cartItem={{ productId: p.id, quantity: 1, name: p.name, price: p.price, image: p.image }} />
              </div>
            </div>
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- New Arrivals ‚Äî Horizontal scroll with warm bg -->
  <section class="border-b-2 border-border bg-primary/5">
    <div class="max-w-screen-2xl mx-auto px-4 sm:px-6 lg:px-8 py-14 md:py-20">
      <div class="flex items-end justify-between mb-8 md:mb-10">
        <div>
          <span class="text-[10px] font-bold uppercase tracking-[0.25em] text-muted-foreground">–®–∏–Ω—ç –Ω—ç–º—ç–≥–¥—Å—ç–Ω</span>
          <h2 class="text-3xl md:text-4xl font-black uppercase tracking-tight mt-1">–®–∏–Ω—ç –∏—Ä—Å—ç–Ω</h2>
        </div>
        <a href="/products?filter=recent" class="hidden sm:inline-flex px-4 py-2 border-2 border-border font-bold text-xs uppercase tracking-wider hover:bg-foreground hover:text-background transition-colors">
          –ë“Ø–≥–¥–∏–π–≥ “Ø–∑—ç—Ö
        </a>
      </div>

      <div class="flex overflow-x-auto gap-3 md:gap-4 pb-4 -mx-4 px-4 snap-x snap-mandatory scrollbar-hide lg:grid lg:grid-cols-4 lg:overflow-visible lg:mx-0 lg:px-0 lg:pb-0">
        {newProducts.map((p: ProductForHome) => (
          <div class="flex-none w-[220px] lg:w-auto snap-start group border-2 border-border bg-card hover:shadow-hard transition-all hover:-translate-y-0.5">
            <a href={`/products/${p.slug}-${p.id}`} class="block">
              <div class="relative aspect-square overflow-hidden border-b-2 border-border" style={`background: ${productColors[p.id % productColors.length]}`}>
                {p.image && (
                  <img src={p.image} alt={p.name} class="absolute inset-0 w-full h-full object-contain p-5 group-hover:scale-105 transition-transform duration-300" width="400" height="400" loading="lazy" />
                )}
              </div>
            </a>
            <div class="p-2.5 md:p-3.5">
              <div class="text-[8px] md:text-[9px] font-bold uppercase tracking-widest text-muted-foreground">{p.brand}</div>
              <a href={`/products/${p.slug}-${p.id}`}>
                <h3 class="text-[11px] md:text-sm font-bold line-clamp-2 mt-0.5 leading-tight group-hover:underline">{p.name}</h3>
              </a>
              <div class="flex items-center justify-between mt-2.5 pt-2.5 border-t-2 border-border">
                <span class="font-black text-sm md:text-base">{formatCurrency(p.price)}</span>
                <AddToCartButton client:load compact cartItem={{ productId: p.id, quantity: 1, name: p.name, price: p.price, image: p.image }} />
              </div>
            </div>
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- Discounted Products -->
  <section class="border-b-2 border-border">
    <div class="max-w-screen-2xl mx-auto px-4 sm:px-6 lg:px-8 py-14 md:py-20">
      <div class="flex items-end justify-between mb-8 md:mb-10">
        <div>
          <span class="text-[10px] font-bold uppercase tracking-[0.25em] text-muted-foreground">–¢—É—Å–≥–∞–π —Å–∞–Ω–∞–ª</span>
          <h2 class="text-3xl md:text-4xl font-black uppercase tracking-tight mt-1">–•—è–º–¥—Ä–∞–ª—Ç–∞–π</h2>
        </div>
        <a href="/products?filter=discount" class="hidden sm:inline-flex px-4 py-2 border-2 border-border font-bold text-xs uppercase tracking-wider hover:bg-foreground hover:text-background transition-colors">
          –ë“Ø–≥–¥–∏–π–≥ “Ø–∑—ç—Ö
        </a>
      </div>

      <!-- 2 large + rest in grid -->
      <div class="grid lg:grid-cols-3 gap-3 md:gap-4 mb-3 md:mb-4">
        {discountedProducts.slice(0, 3).map((p: ProductForHome) => (
          <div class="group border-2 border-border bg-card hover:shadow-hard transition-all hover:-translate-y-0.5">
            <a href={`/products/${p.slug}-${p.id}`} class="block">
              <div class="relative aspect-[4/3] overflow-hidden border-b-2 border-border" style={`background: ${productColors[p.id % productColors.length]}`}>
                {p.discount && (
                  <div class="absolute top-2 left-2 z-10 px-2.5 py-1 bg-foreground text-background text-[10px] font-black border-2 border-foreground">-{p.discount}%</div>
                )}
                {p.image && (
                  <img src={p.image} alt={p.name} class="absolute inset-0 w-full h-full object-contain p-6 group-hover:scale-105 transition-transform duration-300" width="400" height="300" loading="lazy" />
                )}
              </div>
            </a>
            <div class="p-3 md:p-4">
              <div class="text-[8px] md:text-[9px] font-bold uppercase tracking-widest text-muted-foreground">{p.brand}</div>
              <a href={`/products/${p.slug}-${p.id}`}>
                <h3 class="text-sm md:text-base font-bold leading-tight mt-1 group-hover:underline">{p.name}</h3>
              </a>
              <div class="flex items-center justify-between mt-3 pt-3 border-t-2 border-border">
                <span class="font-black text-base md:text-lg">{formatCurrency(p.price)}</span>
                <AddToCartButton client:load compact cartItem={{ productId: p.id, quantity: 1, name: p.name, price: p.price, image: p.image }} />
              </div>
            </div>
          </div>
        ))}
      </div>
      <div class="grid grid-cols-2 lg:grid-cols-4 gap-2 md:gap-3">
        {discountedProducts.slice(3).map((p: ProductForHome) => (
          <div class="group border-2 border-border bg-card hover:shadow-hard transition-all hover:-translate-y-0.5">
            <a href={`/products/${p.slug}-${p.id}`} class="block">
              <div class="relative aspect-square overflow-hidden border-b-2 border-border" style={`background: ${productColors[p.id % productColors.length]}`}>
                {p.discount && (
                  <div class="absolute top-2 left-2 z-10 px-2 py-0.5 bg-foreground text-background text-[10px] font-black">-{p.discount}%</div>
                )}
                {p.image && (
                  <img src={p.image} alt={p.name} class="absolute inset-0 w-full h-full object-contain p-4 group-hover:scale-105 transition-transform duration-300" width="400" height="400" loading="lazy" />
                )}
              </div>
            </a>
            <div class="p-2 md:p-3">
              <div class="text-[8px] md:text-[9px] font-bold uppercase tracking-widest text-muted-foreground">{p.brand}</div>
              <a href={`/products/${p.slug}-${p.id}`}>
                <h3 class="text-[10px] md:text-xs font-bold line-clamp-1 mt-0.5 group-hover:underline">{p.name}</h3>
              </a>
              <div class="flex items-center justify-between mt-2 pt-2 border-t-2 border-border">
                <span class="font-black text-sm">{formatCurrency(p.price)}</span>
                <AddToCartButton client:load compact cartItem={{ productId: p.id, quantity: 1, name: p.name, price: p.price, image: p.image }} />
              </div>
            </div>
          </div>
        ))}
      </div>
      <p class="mt-5 text-[10px] font-semibold text-muted-foreground text-center">–≠–º–Ω—ç–ª–≥–∏–π–Ω –∑”©–≤–ª”©–≥”©”© –±–∏—à. –ú—ç—Ä–≥—ç–∂–ª–∏–π–Ω —ç–º—á–∏–¥ —Ö–∞–Ω–¥–∞–Ω–∞ —É—É.</p>
    </div>
  </section>

  <!-- Brand ticker -->
  <section class="border-b-2 border-border overflow-hidden">
    <div class="py-4 flex items-center gap-12 whitespace-nowrap" style="animation: brand-scroll-5 35s linear infinite;">
      {[...Array(4)].map(() => brands.map((brand: {name: string}) => (
        <span class="text-lg md:text-xl font-black uppercase tracking-wider text-muted-foreground/30 flex items-center gap-12">
          {brand.name}
          <span class="w-1.5 h-1.5 bg-primary/40 rotate-45 block"></span>
        </span>
      )))}
    </div>
  </section>

  <!-- CTA: Warm boutique feel -->
  <section class="py-14 md:py-20">
    <div class="max-w-screen-2xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="border-4 border-border bg-primary p-8 md:p-14 shadow-hard-lg relative overflow-hidden">
        <div class="absolute inset-0 bg-grid-pattern opacity-10 pointer-events-none"></div>
        <div class="relative z-10 max-w-2xl mx-auto text-center">
          <span class="text-[10px] font-bold uppercase tracking-[0.3em] text-foreground/50 mb-4 block">Amerik Vitamin</span>
          <h2 class="text-3xl md:text-5xl font-black uppercase tracking-tight mb-4">–ì—ç—Ä –±“Ø–ª–∏–π–Ω—Ö—ç–Ω–¥—ç—ç –∑–æ—Ä–∏—É–ª–∞–∞—Ä–∞–π</h2>
          <p class="text-sm md:text-base font-medium mb-8 max-w-md mx-auto">–ê–ù–£-—ã–Ω —à–∏–ª–¥—ç–≥ –≤–∏—Ç–∞–º–∏–Ω, –Ω—ç–º—ç–ª—Ç —Ç—ç–∂—ç—ç–ª ‚Äî –∑–æ—Ä–∏–ª–≥–æ–¥–æ–æ —Ç–æ—Ö–∏—Ä—Å–æ–Ω —Å–æ–Ω–≥–æ–ª—Ç—ã–≥ —Ö–∏–π–≥—ç—ç—Ä—ç–π.</p>
          <a href="/products" class="inline-flex px-10 py-4 bg-foreground text-background font-black text-sm uppercase tracking-wider border-2 border-foreground hover:bg-background hover:text-foreground transition-colors">
            –î—ç–ª–≥“Ø“Ø—Ä —Ö—ç—Å—ç—Ö
          </a>
        </div>
      </div>
    </div>
  </section>
</Layout>

<style>
  @keyframes brand-scroll-5 {
    0% { transform: translateX(0); }
    100% { transform: translateX(-50%); }
  }
</style>
