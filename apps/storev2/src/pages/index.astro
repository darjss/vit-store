---
import Layout from "@/layouts/Layout.astro";
import Hero from "@/components/home/Hero.astro";
import ProductSection from "@/components/home/ProductSection.astro";
import CategoryGrid from "@/components/home/CategoryGrid.astro";
import BenefitsSection from "@/components/home/BenefitsSection.astro";
import CTASection from "@/components/home/CTASection.astro";

export const prerender = true;

import { api } from "@/lib/trpc";

const products = await api.product.getProductsForHome.query();
console.log("products", products);
const { featuredProducts, newProducts, discountedProducts } = products;

// JSON-LD for WebSite and Organization
const websiteSchema = {
  "@context": "https://schema.org",
  "@type": "WebSite",
  name: "Америк Витамин",
  url: "https://amerikvitamin.mn",
  description: "АНУ-ын шилдэг брэндүүдийн витамин, нэмэлт тэжээл",
  potentialAction: {
    "@type": "SearchAction",
    target: {
      "@type": "EntryPoint",
      urlTemplate: "https://amerikvitamin.mn/products?q={search_term_string}"
    },
    "query-input": "required name=search_term_string"
  }
};

const organizationSchema = {
  "@context": "https://schema.org",
  "@type": "Organization",
  name: "Америк Витамин",
  url: "https://amerikvitamin.mn",
  logo: "https://amerikvitamin.mn/logo1.png",
  sameAs: [],
  contactPoint: {
    "@type": "ContactPoint",
    contactType: "customer service",
    availableLanguage: "Mongolian"
  }
};
---

<Layout>
    <!-- JSON-LD Structured Data -->
    <script type="application/ld+json" set:html={JSON.stringify(websiteSchema)} />
    <script type="application/ld+json" set:html={JSON.stringify(organizationSchema)} />
    
    <Hero />

    <ProductSection
        title="Онцлох бүтээгдэхүүн"
        subtitle="Манай шилдэг сонголтууд"
        products={featuredProducts}
        filterLink="filter=featured"
        badgeStyle="featured"
    />

    <CategoryGrid />

    <ProductSection
        title="Шинэ ирсэн"
        subtitle="Хамгийн сүүлийн үеийн нэмэлтүүд"
        products={newProducts}
        filterLink="filter=recent"
        badgeStyle="new"
        bgClass="bg-muted/20 border-y-2 border-border"
    />

    <ProductSection
        title="Хямдралтай"
        subtitle="Тусгай үнийн саналууд"
        products={discountedProducts}
        filterLink="filter=discount"
        badgeStyle="discount"
        disclaimer="Эмнэлгийн зөвлөгөө биш. Мэргэжлийн эмчид хандана уу."
    />

    <BenefitsSection />

    <CTASection
        title="Эрүүл мэндээ дэмжээрэй"
        description="АНУ-ын шилдэг брэндүүдийн витамин, нэмэлт тэжээлүүд таны гарт."
        buttonText="Дэлгүүр хэсэх"
        buttonLink="/products"
    />
</Layout>
