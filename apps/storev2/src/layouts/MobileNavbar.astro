---







import MobileCartButton from "@/components/cart/mobile-cart-button";
import MobileSearchButton from "@/components/search/mobile-search-button";
import IconHome from "~icons/ri/home-4-line";
import IconStore from "~icons/ri/store-2-line";
---

<nav
    class="md:hidden fixed inset-x-0 bottom-0 z-50 border-t-4 border-black bg-white h-[73px]" transition:persist transition:name="mobile-navbar"
>
    <div class="mx-auto max-w-screen-sm">
        <ul class="grid grid-cols-4 gap-1 px-3 py-2">
            <li>
                <a
                    href="/"
                    class="group block rounded-sm px-3 py-2 transition-colors duration-200 text-foreground/70 hover:text-foreground hover:bg-primary focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"
                    aria-label="Нүүр"
                >
                    <div class="flex flex-col items-center gap-1">
                        <IconHome class="w-5 h-5 transition-transform duration-200 group-hover:scale-110" aria-hidden="true" />
                        <p class="font-bold text-[11px] leading-none">Нүүр</p>
                    </div>
                </a>
            </li>

            <li>
                <a
                    href="/products"
                    class="group block rounded-sm px-3 py-2 transition-colors duration-200 text-foreground/70 hover:text-foreground hover:bg-primary focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"
                    aria-label="Бүтээгдэхүүн"
                >
                    <div class="flex flex-col items-center gap-1">
                        <IconStore class="w-5 h-5 transition-transform duration-200 group-hover:scale-110" aria-hidden="true" />
                        <p class="font-bold text-[11px] leading-none">
                            Бүтээгдэхүүн
                        </p>
                    </div>
                </a>
            </li>

            <li>
                <MobileCartButton client:idle />
            </li>

            <li>
                <MobileSearchButton client:idle />
            </li>
        </ul>
    </div>
</nav>

<script>
    function updateActiveLink() {
        const currentPath = window.location.pathname;
        const links = document.querySelectorAll('nav[class*="bottom-0"] a');

        links.forEach((link) => {
            const href = link.getAttribute("href");
            if (href) {
                link.classList.remove(
                    "bg-primary",
                    "text-primary-foreground",
                    "shadow-[2px_2px_0_0_#000]",
                );
                link.classList.add("text-foreground/70");

                if (
                    (href === "/" && currentPath === "/") ||
                    (href !== "/" && currentPath.startsWith(href))
                ) {
                    link.classList.add(
                        "bg-primary",
                        "text-primary-foreground",
                        "shadow-[2px_2px_0_0_#000]",
                    );
                    link.classList.remove("text-foreground/70");
                }
            }
        });
    }

    updateActiveLink();

    document.addEventListener("astro:after-swap", updateActiveLink);
</script>
