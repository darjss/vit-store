{"version":3,"file":"index.js","names":["result: Record<string, unknown>","entry: LogEntry"],"sources":["../src/context.ts","../src/logger.ts","../src/middleware.ts"],"sourcesContent":["import type { LogContext, UserType } from \"./types\";\n\nexport function extractClientIp(request: Request): string | undefined {\n\tconst ip = request.headers.get(\"cf-connecting-ip\");\n\tif (!ip) return undefined;\n\n\tconst parts = ip.split(\".\");\n\tif (parts.length === 4) {\n\t\treturn `${parts[0]}.${parts[1]}.x.x`;\n\t}\n\n\tconst ipv6Parts = ip.split(\":\");\n\tif (ipv6Parts.length > 1) {\n\t\treturn `${ipv6Parts[0]}:${ipv6Parts[1]}:***`;\n\t}\n\n\treturn ip;\n}\n\nexport function extractCfContext(\n\trequest: Request,\n): Pick<LogContext, \"rayId\" | \"colo\" | \"clientIp\"> {\n\tconst cf = (request as Request & { cf?: { colo?: string } }).cf;\n\n\treturn {\n\t\trayId: request.headers.get(\"cf-ray\") ?? undefined,\n\t\tcolo: cf?.colo,\n\t\tclientIp: extractClientIp(request),\n\t};\n}\n\nexport function createRequestContext(\n\trequest: Request,\n\toptions?: {\n\t\trequestId?: string;\n\t\tuserId?: number | string;\n\t\tuserPhone?: number;\n\t\tuserEmail?: string;\n\t\tuserType?: UserType;\n\t},\n): LogContext {\n\tconst url = new URL(request.url);\n\tconst cfContext = extractCfContext(request);\n\n\treturn {\n\t\trequestId: options?.requestId ?? crypto.randomUUID(),\n\t\trayId: cfContext.rayId,\n\t\tcolo: cfContext.colo,\n\t\tclientIp: cfContext.clientIp,\n\t\tpath: url.pathname,\n\t\tmethod: request.method,\n\t\tuserId: options?.userId,\n\t\tuserPhone: options?.userPhone,\n\t\tuserEmail: options?.userEmail,\n\t\tuserType: options?.userType ?? \"anonymous\",\n\t};\n}\n\nexport function enrichWithCustomerSession(\n\tcontext: LogContext,\n\tsession: { user: { id?: number; phone: number } } | null,\n): LogContext {\n\tif (!session) return context;\n\n\treturn {\n\t\t...context,\n\t\tuserId: session.user.id,\n\t\tuserPhone: session.user.phone,\n\t\tuserType: \"customer\",\n\t};\n}\n\nexport function enrichWithAdminSession(\n\tcontext: LogContext,\n\tsession: { user: { id: string; name?: string } } | null,\n): LogContext {\n\tif (!session) return context;\n\n\treturn {\n\t\t...context,\n\t\tuserId: session.user.id,\n\t\tuserEmail: session.user.name,\n\t\tuserType: \"admin\",\n\t};\n}\n","import type {\n\tAdminEventData,\n\tAdminLogger,\n\tAuthEventData,\n\tAuthLogger,\n\tLogContext,\n\tLogEntry,\n\tLogger,\n\tLogLevel,\n\tOrderEventData,\n\tOrderLogger,\n\tPaymentEventData,\n\tPaymentLogger,\n\tProductEventData,\n\tProductLogger,\n\tSystemEventData,\n\tSystemLogger,\n\tWebhookEventData,\n\tWebhookLogger,\n} from \"./types\";\n\nfunction formatError(error: Error | unknown): LogEntry[\"error\"] | undefined {\n\tif (!error) return undefined;\n\n\tif (error instanceof Error) {\n\t\treturn {\n\t\t\tname: error.name,\n\t\t\tmessage: error.message,\n\t\t\tstack: error.stack,\n\t\t};\n\t}\n\n\tif (typeof error === \"string\") {\n\t\treturn {\n\t\t\tname: \"Error\",\n\t\t\tmessage: error,\n\t\t};\n\t}\n\n\treturn {\n\t\tname: \"UnknownError\",\n\t\tmessage: String(error),\n\t};\n}\n\nfunction toSnakeCase(obj: Record<string, unknown>): Record<string, unknown> {\n\tconst result: Record<string, unknown> = {};\n\tfor (const [key, value] of Object.entries(obj)) {\n\t\tconst snakeKey = key.replace(/([A-Z])/g, \"_$1\").toLowerCase();\n\t\tresult[snakeKey] = value;\n\t}\n\treturn result;\n}\n\nfunction createLogEntry(\n\tlevel: LogLevel,\n\tevent: string,\n\tcontext: LogContext,\n\tdata?: Record<string, unknown>,\n\terror?: Error | unknown,\n\tdurationMs?: number,\n): LogEntry {\n\tconst entry: LogEntry = {\n\t\tlevel,\n\t\tevent,\n\t\ttimestamp: new Date().toISOString(),\n\t\trequest_id: context.requestId,\n\t\tuser_type: context.userType,\n\t};\n\n\tif (context.rayId) entry.ray_id = context.rayId;\n\tif (context.userId) entry.user_id = context.userId;\n\tif (context.userPhone) entry.user_phone = context.userPhone;\n\tif (context.userEmail) entry.user_email = context.userEmail;\n\n\tif (data && Object.keys(data).length > 0) {\n\t\tentry.data = toSnakeCase(data);\n\t}\n\n\tif (durationMs !== undefined) {\n\t\tentry.duration_ms = durationMs;\n\t}\n\n\tconst formattedError = formatError(error);\n\tif (formattedError) {\n\t\tentry.error = formattedError;\n\t}\n\n\treturn entry;\n}\n\nfunction output(entry: LogEntry): void {\n\tswitch (entry.level) {\n\t\tcase \"debug\":\n\t\t\tconsole.debug(entry);\n\t\t\tbreak;\n\t\tcase \"info\":\n\t\t\tconsole.log(entry);\n\t\t\tbreak;\n\t\tcase \"warn\":\n\t\t\tconsole.warn(entry);\n\t\t\tbreak;\n\t\tcase \"error\":\n\t\t\tconsole.error(entry);\n\t\t\tbreak;\n\t}\n}\n\nfunction createAuthLogger(\n\tcontext: LogContext,\n\tlog: (level: LogLevel, event: string, data?: Record<string, unknown>) => void,\n): AuthLogger {\n\treturn {\n\t\totpSent: (data) => log(\"info\", \"auth.otp_sent\", data),\n\t\totpVerified: (data) => log(\"info\", \"auth.otp_verified\", data),\n\t\totpFailed: (data) => log(\"warn\", \"auth.otp_failed\", data),\n\t\tloginSuccess: (data) => log(\"info\", \"auth.login_success\", data),\n\t\tloginFailed: (data) => log(\"warn\", \"auth.login_failed\", data),\n\t\tsessionCreated: (data) => log(\"info\", \"auth.session_created\", data),\n\t\tsessionExpired: (data) => log(\"info\", \"auth.session_expired\", data),\n\t\tsessionRenewed: (data) => log(\"debug\", \"auth.session_renewed\", data),\n\t\tlogout: (data) => log(\"info\", \"auth.logout\", data),\n\t};\n}\n\nfunction createOrderLogger(\n\tcontext: LogContext,\n\tlog: (level: LogLevel, event: string, data?: Record<string, unknown>) => void,\n): OrderLogger {\n\treturn {\n\t\tcreated: (data) => log(\"info\", \"order.created\", data),\n\t\tupdated: (data) => log(\"info\", \"order.updated\", data),\n\t\tstatusChanged: (data) => log(\"info\", \"order.status_changed\", data),\n\t\tcancelled: (data) => log(\"warn\", \"order.cancelled\", data),\n\t\tcompleted: (data) => log(\"info\", \"order.completed\", data),\n\t\tviewed: (data) => log(\"debug\", \"order.viewed\", data),\n\t};\n}\n\nfunction createPaymentLogger(\n\tcontext: LogContext,\n\tlog: (level: LogLevel, event: string, data?: Record<string, unknown>) => void,\n): PaymentLogger {\n\treturn {\n\t\tcreated: (data) => log(\"info\", \"payment.created\", data),\n\t\tconfirmed: (data) => log(\"info\", \"payment.confirmed\", data),\n\t\tfailed: (data) => log(\"error\", \"payment.failed\", data),\n\t\tstatusChanged: (data) => log(\"info\", \"payment.status_changed\", data),\n\t\tnotificationSent: (data) => log(\"info\", \"payment.notification_sent\", data),\n\t};\n}\n\nfunction createProductLogger(\n\tcontext: LogContext,\n\tlog: (level: LogLevel, event: string, data?: Record<string, unknown>) => void,\n): ProductLogger {\n\treturn {\n\t\tcreated: (data) => log(\"info\", \"product.created\", data),\n\t\tupdated: (data) => log(\"info\", \"product.updated\", data),\n\t\tdeleted: (data) => log(\"warn\", \"product.deleted\", data),\n\t\tviewed: (data) => log(\"debug\", \"product.viewed\", data),\n\t\tsearched: (data) => log(\"debug\", \"product.searched\", data),\n\t};\n}\n\nfunction createAdminLogger(\n\tcontext: LogContext,\n\tlog: (level: LogLevel, event: string, data?: Record<string, unknown>) => void,\n): AdminLogger {\n\treturn {\n\t\tlogin: (data) => log(\"info\", \"admin.login\", data),\n\t\taction: (data) => log(\"info\", \"admin.action\", data),\n\t\tbulkAction: (data) => log(\"info\", \"admin.bulk_action\", data),\n\t\tsyncTriggered: (data) => log(\"info\", \"admin.sync_triggered\", data),\n\t};\n}\n\nfunction createSystemLogger(\n\tcontext: LogContext,\n\tlog: (level: LogLevel, event: string, data?: Record<string, unknown>) => void,\n): SystemLogger {\n\treturn {\n\t\trequestStart: (data) => log(\"debug\", \"system.request_start\", data),\n\t\trequestEnd: (data) => log(\"info\", \"system.request_end\", data),\n\t\trequestError: (data) => log(\"error\", \"system.request_error\", data),\n\t\tcacheHit: (data) => log(\"debug\", \"cache.hit\", data),\n\t\tcacheMiss: (data) => log(\"debug\", \"cache.miss\", data),\n\t\tcacheSet: (data) => log(\"debug\", \"cache.set\", data),\n\t\trateLimited: (data) => log(\"warn\", \"system.rate_limited\", data),\n\t};\n}\n\nfunction createWebhookLogger(\n\tcontext: LogContext,\n\tlog: (level: LogLevel, event: string, data?: Record<string, unknown>) => void,\n): WebhookLogger {\n\treturn {\n\t\treceived: (data) => log(\"info\", \"webhook.received\", data),\n\t\tprocessed: (data) => log(\"info\", \"webhook.processed\", data),\n\t\tfailed: (data) => log(\"error\", \"webhook.failed\", data),\n\t};\n}\n\nexport function createLogger(context: LogContext): Logger {\n\tconst log = (\n\t\tlevel: LogLevel,\n\t\tevent: string,\n\t\tdata?: Record<string, unknown>,\n\t\terror?: Error | unknown,\n\t\tdurationMs?: number,\n\t) => {\n\t\tconst entry = createLogEntry(\n\t\t\tlevel,\n\t\t\tevent,\n\t\t\tcontext,\n\t\t\tdata,\n\t\t\terror,\n\t\t\tdurationMs,\n\t\t);\n\t\toutput(entry);\n\t};\n\n\tconst logWithLevel = (\n\t\tlevel: LogLevel,\n\t\tevent: string,\n\t\tdata?: Record<string, unknown>,\n\t) => {\n\t\tlog(level, event, data);\n\t};\n\n\tconst logger: Logger = {\n\t\tdebug: (event, data) => log(\"debug\", event, data),\n\t\tinfo: (event, data) => log(\"info\", event, data),\n\t\twarn: (event, data) => log(\"warn\", event, data),\n\t\terror: (event, error, data) => log(\"error\", event, data, error),\n\n\t\tauth: createAuthLogger(context, logWithLevel),\n\t\torder: createOrderLogger(context, logWithLevel),\n\t\tpayment: createPaymentLogger(context, logWithLevel),\n\t\tproduct: createProductLogger(context, logWithLevel),\n\t\tadmin: createAdminLogger(context, logWithLevel),\n\t\tsystem: createSystemLogger(context, logWithLevel),\n\t\twebhook: createWebhookLogger(context, logWithLevel),\n\n\t\tchild: (additionalContext) => {\n\t\t\treturn createLogger({ ...context, ...additionalContext });\n\t\t},\n\n\t\tgetContext: () => context,\n\t};\n\n\treturn logger;\n}\n\nexport function createMinimalLogger(): Logger {\n\treturn createLogger({\n\t\trequestId: \"system\",\n\t\tuserType: \"system\",\n\t});\n}\n\nexport function generateRequestId(): string {\n\treturn crypto.randomUUID();\n}\n","import type { Context, MiddlewareHandler } from \"hono\";\nimport { createRequestContext } from \"./context\";\nimport { createLogger, generateRequestId } from \"./logger\";\nimport type { LogContext, Logger, UserType } from \"./types\";\n\nconst LOGGER_KEY = \"logger\";\nconst LOG_CONTEXT_KEY = \"logContext\";\n\nexport function getLogger(c: Context): Logger {\n\tconst logger = c.get(LOGGER_KEY) as Logger | undefined;\n\tif (!logger) {\n\t\treturn createLogger({\n\t\t\trequestId: generateRequestId(),\n\t\t\tuserType: \"anonymous\",\n\t\t});\n\t}\n\treturn logger;\n}\n\nexport function getLogContext(c: Context): LogContext | undefined {\n\treturn c.get(LOG_CONTEXT_KEY) as LogContext | undefined;\n}\n\nexport function setLogger(c: Context, logger: Logger): void {\n\tc.set(LOGGER_KEY, logger);\n\tc.set(LOG_CONTEXT_KEY, logger.getContext());\n}\n\nexport function updateLoggerContext(\n\tc: Context,\n\tupdates: Partial<LogContext>,\n): Logger {\n\tconst currentLogger = getLogger(c);\n\tconst newLogger = currentLogger.child(updates);\n\tsetLogger(c, newLogger);\n\treturn newLogger;\n}\n\nexport interface LoggerMiddlewareOptions {\n\tgetUserInfo?: (c: Context) => {\n\t\tuserId?: number | string;\n\t\tuserPhone?: number;\n\t\tuserEmail?: string;\n\t\tuserType?: UserType;\n\t} | null;\n\n\tlogRequestStart?: boolean;\n\tlogRequestEnd?: boolean;\n\texcludePaths?: string[];\n}\n\nexport function loggerMiddleware(\n\toptions: LoggerMiddlewareOptions = {},\n): MiddlewareHandler {\n\tconst {\n\t\tlogRequestStart = true,\n\t\tlogRequestEnd = true,\n\t\texcludePaths = [\"/health-check\", \"/favicon.ico\"],\n\t} = options;\n\n\treturn async (c, next) => {\n\t\tconst startTime = Date.now();\n\t\tconst url = new URL(c.req.url);\n\n\t\tif (excludePaths.includes(url.pathname)) {\n\t\t\treturn next();\n\t\t}\n\n\t\tconst requestId = generateRequestId();\n\t\tconst logContext = createRequestContext(c.req.raw, {\n\t\t\trequestId,\n\t\t\tuserType: \"anonymous\",\n\t\t});\n\n\t\tconst logger = createLogger(logContext);\n\t\tsetLogger(c, logger);\n\n\t\tif (logRequestStart) {\n\t\t\tlogger.system.requestStart({\n\t\t\t\tpath: url.pathname,\n\t\t\t\tmethod: c.req.method,\n\t\t\t});\n\t\t}\n\n\t\ttry {\n\t\t\tawait next();\n\n\t\t\tconst durationMs = Date.now() - startTime;\n\n\t\t\tif (options.getUserInfo) {\n\t\t\t\tconst userInfo = options.getUserInfo(c);\n\t\t\t\tif (userInfo) {\n\t\t\t\t\tupdateLoggerContext(c, {\n\t\t\t\t\t\tuserId: userInfo.userId,\n\t\t\t\t\t\tuserPhone: userInfo.userPhone,\n\t\t\t\t\t\tuserEmail: userInfo.userEmail,\n\t\t\t\t\t\tuserType: userInfo.userType ?? \"anonymous\",\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (logRequestEnd) {\n\t\t\t\tconst finalLogger = getLogger(c);\n\t\t\t\tfinalLogger.system.requestEnd({\n\t\t\t\t\tpath: url.pathname,\n\t\t\t\t\tmethod: c.req.method,\n\t\t\t\t\tstatus: c.res.status,\n\t\t\t\t\tdurationMs,\n\t\t\t\t});\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconst durationMs = Date.now() - startTime;\n\n\t\t\tlogger.error(\"system.request_error\", error, {\n\t\t\t\tpath: url.pathname,\n\t\t\t\tmethod: c.req.method,\n\t\t\t\tdurationMs,\n\t\t\t});\n\n\t\t\tthrow error;\n\t\t}\n\t};\n}\n\nexport function createTrpcLoggingMiddleware(\n\tgetLoggerFromCtx: (ctx: unknown) => Logger | null,\n) {\n\treturn async <\n\t\tT extends {\n\t\t\tctx: unknown;\n\t\t\tnext: () => Promise<unknown>;\n\t\t\tpath: string;\n\t\t\ttype: string;\n\t\t\tinput: unknown;\n\t\t},\n\t>(\n\t\topts: T,\n\t) => {\n\t\tconst { ctx, next, path, type, input } = opts;\n\t\tconst startTime = Date.now();\n\n\t\tconst logger = getLoggerFromCtx(ctx);\n\t\tconst procedureType = type?.toUpperCase() || \"PROCEDURE\";\n\n\t\tlogger?.info(\"trpc.procedure_start\", {\n\t\t\tprocedure: path,\n\t\t\ttype: procedureType,\n\t\t\thasInput: input !== undefined,\n\t\t});\n\n\t\ttry {\n\t\t\tconst result = await next();\n\t\t\tconst durationMs = Date.now() - startTime;\n\n\t\t\tlogger?.info(\"trpc.procedure_success\", {\n\t\t\t\tprocedure: path,\n\t\t\t\ttype: procedureType,\n\t\t\t\tdurationMs,\n\t\t\t});\n\n\t\t\treturn result;\n\t\t} catch (error) {\n\t\t\tconst durationMs = Date.now() - startTime;\n\n\t\t\tlogger?.error(\"trpc.procedure_error\", error, {\n\t\t\t\tprocedure: path,\n\t\t\t\ttype: procedureType,\n\t\t\t\tdurationMs,\n\t\t\t});\n\n\t\t\tthrow error;\n\t\t}\n\t};\n}\n"],"mappings":";AAEA,SAAgB,gBAAgB,SAAsC;CACrE,MAAM,KAAK,QAAQ,QAAQ,IAAI,mBAAmB;AAClD,KAAI,CAAC,GAAI,QAAO;CAEhB,MAAM,QAAQ,GAAG,MAAM,IAAI;AAC3B,KAAI,MAAM,WAAW,EACpB,QAAO,GAAG,MAAM,GAAG,GAAG,MAAM,GAAG;CAGhC,MAAM,YAAY,GAAG,MAAM,IAAI;AAC/B,KAAI,UAAU,SAAS,EACtB,QAAO,GAAG,UAAU,GAAG,GAAG,UAAU,GAAG;AAGxC,QAAO;;AAGR,SAAgB,iBACf,SACkD;CAClD,MAAM,KAAM,QAAiD;AAE7D,QAAO;EACN,OAAO,QAAQ,QAAQ,IAAI,SAAS,IAAI;EACxC,MAAM,IAAI;EACV,UAAU,gBAAgB,QAAQ;EAClC;;AAGF,SAAgB,qBACf,SACA,SAOa;CACb,MAAM,MAAM,IAAI,IAAI,QAAQ,IAAI;CAChC,MAAM,YAAY,iBAAiB,QAAQ;AAE3C,QAAO;EACN,WAAW,SAAS,aAAa,OAAO,YAAY;EACpD,OAAO,UAAU;EACjB,MAAM,UAAU;EAChB,UAAU,UAAU;EACpB,MAAM,IAAI;EACV,QAAQ,QAAQ;EAChB,QAAQ,SAAS;EACjB,WAAW,SAAS;EACpB,WAAW,SAAS;EACpB,UAAU,SAAS,YAAY;EAC/B;;AAGF,SAAgB,0BACf,SACA,SACa;AACb,KAAI,CAAC,QAAS,QAAO;AAErB,QAAO;EACN,GAAG;EACH,QAAQ,QAAQ,KAAK;EACrB,WAAW,QAAQ,KAAK;EACxB,UAAU;EACV;;AAGF,SAAgB,uBACf,SACA,SACa;AACb,KAAI,CAAC,QAAS,QAAO;AAErB,QAAO;EACN,GAAG;EACH,QAAQ,QAAQ,KAAK;EACrB,WAAW,QAAQ,KAAK;EACxB,UAAU;EACV;;;;;AC9DF,SAAS,YAAY,OAAuD;AAC3E,KAAI,CAAC,MAAO,QAAO;AAEnB,KAAI,iBAAiB,MACpB,QAAO;EACN,MAAM,MAAM;EACZ,SAAS,MAAM;EACf,OAAO,MAAM;EACb;AAGF,KAAI,OAAO,UAAU,SACpB,QAAO;EACN,MAAM;EACN,SAAS;EACT;AAGF,QAAO;EACN,MAAM;EACN,SAAS,OAAO,MAAM;EACtB;;AAGF,SAAS,YAAY,KAAuD;CAC3E,MAAMA,SAAkC,EAAE;AAC1C,MAAK,MAAM,CAAC,KAAK,UAAU,OAAO,QAAQ,IAAI,EAAE;EAC/C,MAAM,WAAW,IAAI,QAAQ,YAAY,MAAM,CAAC,aAAa;AAC7D,SAAO,YAAY;;AAEpB,QAAO;;AAGR,SAAS,eACR,OACA,OACA,SACA,MACA,OACA,YACW;CACX,MAAMC,QAAkB;EACvB;EACA;EACA,4BAAW,IAAI,MAAM,EAAC,aAAa;EACnC,YAAY,QAAQ;EACpB,WAAW,QAAQ;EACnB;AAED,KAAI,QAAQ,MAAO,OAAM,SAAS,QAAQ;AAC1C,KAAI,QAAQ,OAAQ,OAAM,UAAU,QAAQ;AAC5C,KAAI,QAAQ,UAAW,OAAM,aAAa,QAAQ;AAClD,KAAI,QAAQ,UAAW,OAAM,aAAa,QAAQ;AAElD,KAAI,QAAQ,OAAO,KAAK,KAAK,CAAC,SAAS,EACtC,OAAM,OAAO,YAAY,KAAK;AAG/B,KAAI,eAAe,OAClB,OAAM,cAAc;CAGrB,MAAM,iBAAiB,YAAY,MAAM;AACzC,KAAI,eACH,OAAM,QAAQ;AAGf,QAAO;;AAGR,SAAS,OAAO,OAAuB;AACtC,SAAQ,MAAM,OAAd;EACC,KAAK;AACJ,WAAQ,MAAM,MAAM;AACpB;EACD,KAAK;AACJ,WAAQ,IAAI,MAAM;AAClB;EACD,KAAK;AACJ,WAAQ,KAAK,MAAM;AACnB;EACD,KAAK;AACJ,WAAQ,MAAM,MAAM;AACpB;;;AAIH,SAAS,iBACR,SACA,KACa;AACb,QAAO;EACN,UAAU,SAAS,IAAI,QAAQ,iBAAiB,KAAK;EACrD,cAAc,SAAS,IAAI,QAAQ,qBAAqB,KAAK;EAC7D,YAAY,SAAS,IAAI,QAAQ,mBAAmB,KAAK;EACzD,eAAe,SAAS,IAAI,QAAQ,sBAAsB,KAAK;EAC/D,cAAc,SAAS,IAAI,QAAQ,qBAAqB,KAAK;EAC7D,iBAAiB,SAAS,IAAI,QAAQ,wBAAwB,KAAK;EACnE,iBAAiB,SAAS,IAAI,QAAQ,wBAAwB,KAAK;EACnE,iBAAiB,SAAS,IAAI,SAAS,wBAAwB,KAAK;EACpE,SAAS,SAAS,IAAI,QAAQ,eAAe,KAAK;EAClD;;AAGF,SAAS,kBACR,SACA,KACc;AACd,QAAO;EACN,UAAU,SAAS,IAAI,QAAQ,iBAAiB,KAAK;EACrD,UAAU,SAAS,IAAI,QAAQ,iBAAiB,KAAK;EACrD,gBAAgB,SAAS,IAAI,QAAQ,wBAAwB,KAAK;EAClE,YAAY,SAAS,IAAI,QAAQ,mBAAmB,KAAK;EACzD,YAAY,SAAS,IAAI,QAAQ,mBAAmB,KAAK;EACzD,SAAS,SAAS,IAAI,SAAS,gBAAgB,KAAK;EACpD;;AAGF,SAAS,oBACR,SACA,KACgB;AAChB,QAAO;EACN,UAAU,SAAS,IAAI,QAAQ,mBAAmB,KAAK;EACvD,YAAY,SAAS,IAAI,QAAQ,qBAAqB,KAAK;EAC3D,SAAS,SAAS,IAAI,SAAS,kBAAkB,KAAK;EACtD,gBAAgB,SAAS,IAAI,QAAQ,0BAA0B,KAAK;EACpE,mBAAmB,SAAS,IAAI,QAAQ,6BAA6B,KAAK;EAC1E;;AAGF,SAAS,oBACR,SACA,KACgB;AAChB,QAAO;EACN,UAAU,SAAS,IAAI,QAAQ,mBAAmB,KAAK;EACvD,UAAU,SAAS,IAAI,QAAQ,mBAAmB,KAAK;EACvD,UAAU,SAAS,IAAI,QAAQ,mBAAmB,KAAK;EACvD,SAAS,SAAS,IAAI,SAAS,kBAAkB,KAAK;EACtD,WAAW,SAAS,IAAI,SAAS,oBAAoB,KAAK;EAC1D;;AAGF,SAAS,kBACR,SACA,KACc;AACd,QAAO;EACN,QAAQ,SAAS,IAAI,QAAQ,eAAe,KAAK;EACjD,SAAS,SAAS,IAAI,QAAQ,gBAAgB,KAAK;EACnD,aAAa,SAAS,IAAI,QAAQ,qBAAqB,KAAK;EAC5D,gBAAgB,SAAS,IAAI,QAAQ,wBAAwB,KAAK;EAClE;;AAGF,SAAS,mBACR,SACA,KACe;AACf,QAAO;EACN,eAAe,SAAS,IAAI,SAAS,wBAAwB,KAAK;EAClE,aAAa,SAAS,IAAI,QAAQ,sBAAsB,KAAK;EAC7D,eAAe,SAAS,IAAI,SAAS,wBAAwB,KAAK;EAClE,WAAW,SAAS,IAAI,SAAS,aAAa,KAAK;EACnD,YAAY,SAAS,IAAI,SAAS,cAAc,KAAK;EACrD,WAAW,SAAS,IAAI,SAAS,aAAa,KAAK;EACnD,cAAc,SAAS,IAAI,QAAQ,uBAAuB,KAAK;EAC/D;;AAGF,SAAS,oBACR,SACA,KACgB;AAChB,QAAO;EACN,WAAW,SAAS,IAAI,QAAQ,oBAAoB,KAAK;EACzD,YAAY,SAAS,IAAI,QAAQ,qBAAqB,KAAK;EAC3D,SAAS,SAAS,IAAI,SAAS,kBAAkB,KAAK;EACtD;;AAGF,SAAgB,aAAa,SAA6B;CACzD,MAAM,OACL,OACA,OACA,MACA,OACA,eACI;AASJ,SARc,eACb,OACA,OACA,SACA,MACA,OACA,WACA,CACY;;CAGd,MAAM,gBACL,OACA,OACA,SACI;AACJ,MAAI,OAAO,OAAO,KAAK;;AAwBxB,QArBuB;EACtB,QAAQ,OAAO,SAAS,IAAI,SAAS,OAAO,KAAK;EACjD,OAAO,OAAO,SAAS,IAAI,QAAQ,OAAO,KAAK;EAC/C,OAAO,OAAO,SAAS,IAAI,QAAQ,OAAO,KAAK;EAC/C,QAAQ,OAAO,OAAO,SAAS,IAAI,SAAS,OAAO,MAAM,MAAM;EAE/D,MAAM,iBAAiB,SAAS,aAAa;EAC7C,OAAO,kBAAkB,SAAS,aAAa;EAC/C,SAAS,oBAAoB,SAAS,aAAa;EACnD,SAAS,oBAAoB,SAAS,aAAa;EACnD,OAAO,kBAAkB,SAAS,aAAa;EAC/C,QAAQ,mBAAmB,SAAS,aAAa;EACjD,SAAS,oBAAoB,SAAS,aAAa;EAEnD,QAAQ,sBAAsB;AAC7B,UAAO,aAAa;IAAE,GAAG;IAAS,GAAG;IAAmB,CAAC;;EAG1D,kBAAkB;EAClB;;AAKF,SAAgB,sBAA8B;AAC7C,QAAO,aAAa;EACnB,WAAW;EACX,UAAU;EACV,CAAC;;AAGH,SAAgB,oBAA4B;AAC3C,QAAO,OAAO,YAAY;;;;;ACjQ3B,MAAM,aAAa;AACnB,MAAM,kBAAkB;AAExB,SAAgB,UAAU,GAAoB;CAC7C,MAAM,SAAS,EAAE,IAAI,WAAW;AAChC,KAAI,CAAC,OACJ,QAAO,aAAa;EACnB,WAAW,mBAAmB;EAC9B,UAAU;EACV,CAAC;AAEH,QAAO;;AAGR,SAAgB,cAAc,GAAoC;AACjE,QAAO,EAAE,IAAI,gBAAgB;;AAG9B,SAAgB,UAAU,GAAY,QAAsB;AAC3D,GAAE,IAAI,YAAY,OAAO;AACzB,GAAE,IAAI,iBAAiB,OAAO,YAAY,CAAC;;AAG5C,SAAgB,oBACf,GACA,SACS;CAET,MAAM,YADgB,UAAU,EAAE,CACF,MAAM,QAAQ;AAC9C,WAAU,GAAG,UAAU;AACvB,QAAO;;AAgBR,SAAgB,iBACf,UAAmC,EAAE,EACjB;CACpB,MAAM,EACL,kBAAkB,MAClB,gBAAgB,MAChB,eAAe,CAAC,iBAAiB,eAAe,KAC7C;AAEJ,QAAO,OAAO,GAAG,SAAS;EACzB,MAAM,YAAY,KAAK,KAAK;EAC5B,MAAM,MAAM,IAAI,IAAI,EAAE,IAAI,IAAI;AAE9B,MAAI,aAAa,SAAS,IAAI,SAAS,CACtC,QAAO,MAAM;EAGd,MAAM,YAAY,mBAAmB;EAMrC,MAAM,SAAS,aALI,qBAAqB,EAAE,IAAI,KAAK;GAClD;GACA,UAAU;GACV,CAAC,CAEqC;AACvC,YAAU,GAAG,OAAO;AAEpB,MAAI,gBACH,QAAO,OAAO,aAAa;GAC1B,MAAM,IAAI;GACV,QAAQ,EAAE,IAAI;GACd,CAAC;AAGH,MAAI;AACH,SAAM,MAAM;GAEZ,MAAM,aAAa,KAAK,KAAK,GAAG;AAEhC,OAAI,QAAQ,aAAa;IACxB,MAAM,WAAW,QAAQ,YAAY,EAAE;AACvC,QAAI,SACH,qBAAoB,GAAG;KACtB,QAAQ,SAAS;KACjB,WAAW,SAAS;KACpB,WAAW,SAAS;KACpB,UAAU,SAAS,YAAY;KAC/B,CAAC;;AAIJ,OAAI,cAEH,CADoB,UAAU,EAAE,CACpB,OAAO,WAAW;IAC7B,MAAM,IAAI;IACV,QAAQ,EAAE,IAAI;IACd,QAAQ,EAAE,IAAI;IACd;IACA,CAAC;WAEK,OAAO;GACf,MAAM,aAAa,KAAK,KAAK,GAAG;AAEhC,UAAO,MAAM,wBAAwB,OAAO;IAC3C,MAAM,IAAI;IACV,QAAQ,EAAE,IAAI;IACd;IACA,CAAC;AAEF,SAAM;;;;AAKT,SAAgB,4BACf,kBACC;AACD,QAAO,OASN,SACI;EACJ,MAAM,EAAE,KAAK,MAAM,MAAM,MAAM,UAAU;EACzC,MAAM,YAAY,KAAK,KAAK;EAE5B,MAAM,SAAS,iBAAiB,IAAI;EACpC,MAAM,gBAAgB,MAAM,aAAa,IAAI;AAE7C,UAAQ,KAAK,wBAAwB;GACpC,WAAW;GACX,MAAM;GACN,UAAU,UAAU;GACpB,CAAC;AAEF,MAAI;GACH,MAAM,SAAS,MAAM,MAAM;GAC3B,MAAM,aAAa,KAAK,KAAK,GAAG;AAEhC,WAAQ,KAAK,0BAA0B;IACtC,WAAW;IACX,MAAM;IACN;IACA,CAAC;AAEF,UAAO;WACC,OAAO;GACf,MAAM,aAAa,KAAK,KAAK,GAAG;AAEhC,WAAQ,MAAM,wBAAwB,OAAO;IAC5C,WAAW;IACX,MAAM;IACN;IACA,CAAC;AAEF,SAAM"}